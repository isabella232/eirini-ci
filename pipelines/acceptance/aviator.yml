spruce:
- step: "merge resources with groups"
  base: groups.yml
  prune:
  - config
  merge:
  - with:
      files:
      - ./config.yml
      - ../../modules/resources/slack.yml
      - ../../modules/resources/cf-for-k8s-github-release.yml
      - ../../modules/resources/capi-release-github.yml
      - ../../modules/resources/capi-k8s-release-github.yml
      - ../../modules/resources/cf-smoke-tests.yml
      - ../../modules/resources/ci-resources.yml
      - ../../modules/resources/uaa-ready-event.yml
      - ../../modules/resources/cluster-state.yml
      - ../../modules/resources/eirini.yml
      - ../../modules/resources/eirini-release-https.yml
      - ../../modules/resources/eirini-release-version.yml
      - ../../modules/resources/eirini-scf-github-release.yml
      - ../../modules/resources/every-30-seconds.yml
      - ../../modules/resources/gh-pages-pr.yml
      - ../../modules/resources/lock-the-egg-police.yml
      - ../../modules/resources/scf-uaa-resources.yml
      - ../../modules/resources/eirini-staging-master.yml
      - ../../modules/resources/sunday-morning.yml
      - ../../modules/resources/slack-resource-type.yml
  to: {{groups-and-resources}}

- step: "merge acceptance cluster jobs"
  base: {{groups-and-resources}}
  prune:
  - config
  merge:
  - with:
      files:
      - ./config.yml
      - ./config-cluster-acceptance.yml
      - ../../modules/resources/cluster-event-created.yml
      - ../../modules/jobs/delete-ibm-cluster.yml
      - ../../modules/jobs/create-ibm-cluster.yml
      - ../../modules/jobs/prepare-ibm-cluster.yml
      - ../../modules/jobs/slack-notification.yml
  to: {{acceptance-cluster-jobs}}

- step: "merge cf4k8s4a8e cluster jobs"
  base: {{acceptance-cluster-jobs}}
  prune:
  - config
  merge:
  - with:
      files:
      - ./config.yml
      - ./config-cluster-cf4k8s4a8e.yml
      - ../../modules/resources/cluster-event-created.yml
      - ../../modules/jobs/delete-gke-cluster.yml
      - ../../modules/jobs/create-gke-cluster.yml
      - ../../modules/jobs/slack-notification.yml
  to: {{cf4k8s4a8e-cluster-jobs}}

- step: "merge groups and resources with jobs"
  base: {{cf4k8s4a8e-cluster-jobs}}
  prune:
  - slack-notification
  merge:
  - with:
      files:
      - ./config.yml
      - ../../modules/jobs/slack-notification.yml
      - ../../modules/jobs/deploy-scf-uaa.yml
      - ../../modules/jobs/deploy-scf-eirini-acceptance.yml
      - ../../modules/jobs/run-smoke-tests-acceptance.yml
      - ../../modules/jobs/publish-release.yml
      - ../../modules/jobs/cleanup-blobstore.yml
      - ../../modules/jobs/bump-major-version.yml
      - ../../modules/jobs/bump-minor-version.yml
      - ../../modules/jobs/the-egg-police.yml
      - ../../modules/jobs/lock-the-egg-police.yml
      - ../../modules/jobs/unlock-the-egg-police.yml
      - ../../modules/jobs/release-lock-the-egg-police.yml
      - ../../modules/jobs/generate-cf-for-k8s-values.yml
      - ../../modules/jobs/deploy-cf-for-k8s.yml
      - ../../modules/jobs/smoke-tests-cf-for-k8s.yml
      - ../../modules/jobs/bump-cluster-k8s-version.yml
  modify:
    delete:
    - jobs.name:generate-cf-for-k8s-values.plan.get:cluster-((world-name))-staging-event-created
    - jobs.name:delete-cluster-acceptance.plan.get:delete-timer
  to: $PIPELINE_YML
