#@ load("@ytt:data", "data")
#@ load("@ytt:overlay", "overlay")
#@ load("/namespaces.star", "system_namespace", "workloads_namespace")

#@overlay/match by=overlay.subset({"kind": "Gateway", "metadata":{"name": "istio-ingressgateway"}})
---
spec:
  servers:
  #@overlay/match by=overlay.subset({"port":{"name":"https-workloads"}})
  - hosts:
    #@overlay/append
    - #@ workloads_namespace() + '/eirini.cf'
    tls:
      credentialName: eirinidotcf-cert

---
#! Exclude istio-system namespace from the generated yaml so that our
#! letsencrypt secret survives recreation of cf-for-k8s. Rate limit is 5 of same
#! domain per week

#@ load("@ytt:overlay", "overlay")

#@overlay/match by=overlay.subset({"kind":"Namespace", "metadata":{"name":"istio-system"}})
#@overlay/remove
---
